## Start MapReduce
- HDFS에 저장된 파일을 분산 배치 분석을 할수 있게 도와주는 프레임워크
- 데이터 전송, 분산 처리, 내고장성등의 복잡한 처리를 맵리듀스가 자동으로 처리

### 개념
- 맵리듀스는 맵과 리듀스라는 두가지 단계로 데이터를 처리한다.
- 맵은 입력 파일을 한줄 읽어서 데이터를 변형하는 작업이다.
- 리듀스는 맵의 결과 데이터를 집계하는 작업을 한다.
- 맵리듀스 어플리케이션이 동작할때 맵과 리듀스 사이에는 셔플작업이 발생한다.

### 아키텍쳐 - 클라이언트
- 사용자가 실행한 맵리듀스 프로그램과 하둡에서 제공하는 맵리듀스 API를 의미

### 아키텍쳐 - 잡트래커
- 맵리듀스 프로그램은 잡이라는 하나의 작업 단위로 관리된다.
- 잡트래커는 하둡 클러스터에 등록된 전체 잡의 스케줄링을 관리하고 모니터링한다.
- 전체 하둡 클러스터에서 하나의 잡트래커가 실행되며, 보통 하둡의 네임노드 서버에서 실행된다.
- 사용자가 새로운 잡을 요청하면 잡트래커는 잡을 처리하기 위해 몇개의 맵과 리듀스를 실행할지 계산한다.
- 계산된 맵과 리듀스를 어떤 태스크트래커에서 실행할지 결정하고, 해당 태스크트래커에 잡을 할당한다.
- 태스크트래커는 잡트래커의 작업 수행 요청을 받아 맵리듀스 프로그램을 실행
- 잡트래커와 태스크트래커는 하트비트라는 메서드로 네트워크 통신을 하면서 상태와 실행 정보를 주고받게 된다.
- 태스크트래커에 장애가 발생하면 잡트래커는 다른 대기중은 태스크트래커를 찾아 재실행한다.

### 아키텍쳐 - 태스크트래커
- 사용자가 설정한 맵리듀스 프로그램을 실행하며, 하둡의 데이터노드에서 실행되는 데몬이다.
- 태스크트래커는 잡트래커의 작업을 요청받고, 잡트래커가 요청한 맵과 리듀스 개수만큼 맵 태스크와 리듀스 태스크를 생성한다.
- 맵 태스크와 리듀스 태스크가 생성되면 새로운 JVM을 구동해 맵 태스크와 리듀스 태스크를 실행한다.

### 데이터 플로우 - 맵 단계
- 입력 파일을 읽어 맵의 출력 데이터를 생성하는 단계
- 맵리듀스는 HDFS에 저장된 파일을 읽어서 배치 처리한다.
- 대용량 파일을 처리하기 위해 입력 데이터 파일을 입력 스플릿이라는 고정된 크기의 조각으로 분리한다.(가상으로 블록을 분리)
- 입력 스플릿별로 하나의 맵 태스크가 생성되고 각 입력 스플릿은 맵 태스크의 입력 데이터로 전달된다.
- 입력 스플릿은 기본적으로 HDFS블록 크기를 기준으로 생선된다.
- 입력 스플릿의 데이터를 레코드 단위로 읽어서 사용자가 정의한 맵 함수를 실행 한다.
- 맵 태스크의 출력 데이터는 태스크트래커가 실행되는 서버의 로컬 디스크에 저장되며, 맵의 출력키를 기준으로 정렬된다. HDFS에 저장하지 않는 이유는 중간 데이터라서 영구적으로 보관할 필요가 없기 때문이며, 잡이 완료될 경우 중간 데이터는 모두 삭제된다.

### 데이터 플로우 - 셔플
- 맵 태스크의 출력 데이터는 중간 데이터이며, 리듀스 태스크는 이 데이터를 내려 받아 연산을 수행해야 한다.
- 셔플은 맵 태스크의 출력 데이터가 리듀스 태스크에게 전달되는 일련의 과정을 의미
- 파티셔너는 맵의 출력 레코드를 읽어서 출력키의 해시값을 구한다.
- 각 해시값은 레코드가 속하는 파티션 번호로 사용된다.
- 파티션은 실행될 리듀스 태스크 개수만큼 생선된다.
- 파티셔닝된 맵의 출력 데이터는 네트워크를 통해 리듀스 태스크에 전달된다. 하지만 모든 맵의 출력이 동시에 완료되지 않기 때문에 리듀스 태스크는 자신이 처리할 데이터가 모일 때까지 대기한다.
- 리듀스 태스크는 맵의 출력 데이터가 모두 모이면 데이터를 정렬하고, 하나의 입력 데이터로 병합한다.
- 리듀스 태스크는 병합된 데이터를 레코드 단위로 읽어 들인다.

### 데이터 플로우 - 리듀스
- 사용자에게 전달할 출력 파일을 생성한다.
- 리듀스 태스크는 사용자가 정의한 리듀스 함수를 레코드 단위로 실행한다.
- 리듀스 태스크가 읽어 들이는 데이터는 입력키와 입력키에 해당하는 입력값의 목록으로 구성된다. 출력 데이터는 출력키와 출력값의 쌍으로 구성된다.
- 리듀스 함수가 출력한 데이터는 HDFS에 저장된다. HDFS에는 리듀스 개수만큼 출력파일이 생성된다.

### 시퀸스 파일
- 키와 값의 형태로 데이터를 저장하는 바이너리 파일이다.
- 시퀸스파일은 압축을 적용하는 방식에 따라 세가지 유형의 Writer를 제공
- 무압축 : 시퀸스파일에 레코드를 추가하면 키와 레코드를 원본 그대로 저장한다. 무압축 시퀸스파일은 레코드를 텍스트 파일에 저장하는 것보다 용량을 많이 차지하기 때문에 거의 사용하지 않는다.
- 레코드 압축 : 레코드 단위로 데이터를 압축, 블록 단위 압축보다는 압축률이 낮은 편이다.
- 블록 압축 : 레코드를 블록 단위로 압축, 기본적으로 HDFS와 같은 블록 단위로 압축하지만 이 설정은 변경할 수 있다.
- 하둡에서는 다양한 종류의 압축 코덱을 사용할 수 있다 그러나 텍스트 파일은 압축 코덱에 따라 스플릿이 불가능하다. 시퀸스파일은 어떤 압축을 적용하든 스플릿이 가능하다.그래서 데이터를 압축해서 보관하고, 이를 맵리듀스 잡으로 처리해야 할 경우에는 시퀸스 파일로 저장하는 것이 좋다.




