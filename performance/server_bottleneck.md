# 애플리케이션 서버의 병목 발견 방법
- Hang up: 서버 인스턴스는 실행되고 있으나 아무런 응답이 없는 상황(멈춘 상태)
- Slow down: 서버 인스턴스의 응답 시간이 아주 급격히 떨어지는 상태(느려짐)

## 애플리케이션 서버와 User AP에서 Slow down 분석

### 애플리케이션 서버 기본 구조
- 클라이언트로부터 요청을 받고 내용을 분석한다. JSM, HTTP, RMI중 어느 요청인지 분석 한후(Dispatcher), 그 내용을 큐에 저장한다. 스레드들이 큐에서 저장된 요청을 꺼내서 실행한다. 애플리케이션 서버에서는 업무의 성격에 따라 스레드 풀을 나눠서 만들어 놓고 사용한다.

### 스레드 덤프를 이용한 병목 구간 분석
- Hang out 이나 Slow down은 대부분 애플리케이션 서버에서 보이는 경우가 많다.
- 스레드 덤프: 자바 애플리케이션이 작동하는 순간의 스냅샷을 의미한다. 이를 통해 당시의 애플리케이션이 어떻게 작동하고 진행되고 있는가를 살펴볼수 있다. Thread Status는각 스레드의 현재 상태를 나타내고 Program stack of thread는 현재 해당 스레드가 어느 클래스의 어느 메서드를 수행하고 있는지 나타낸다.

### 스레드 덤프 분석 방법
- hang up, slow down시에 여러개의 스레드 덤프를 추출한다. 하나의 메서드에 애플리케이션이 1초이상 머무른다는 것은 있을 수 없는 일이다. 스레드 덤프 분석은 스레드가 시간이 지남에 따라 진행되지 않고 멈춰 있는 스레드를 찾는 것부터 시작한다.
- Lock contention: 스레드 끼리의 공유 영역을 보호하기 위해서 Synchronied Method를 사용한다. 한 스레드가 Lock을 잡은 경우 다른 스레드는 Lock의 반환을 기다려야 한다. 즉, 여러개의 스레드가 하나의 Lock을 동시에 획득하려고 하는 상황을 말한다. 해결하기 위해서는 불필요한 Lock의 사용을 자제하고 Synchronized 블록 안에서의 최적화된 알고리즘을 사용한다.
- Dead Lock: 두 개 이상의 스레드가 서로 Lock을 잡고 기다리는 환형 대기조건이 성립되었을때 서로 Lock이 풀리지 않고 무한대기하는 현상이다. Dead Lock은 Locking condition을 비교함으로써 검출 할 수있고, 최신 JVM에서는 스레드 덤프 추출시 Dead Lock이 있다면 추출해준다. 해결방안으로는 서로 Lock을 보는 것을 다른 Locking Object를 사용하거나 Lock의 방향을 바꿔줌으로써 해결할 수 있다.
- I/O 응답 대기: 각각의 스레드들이 I/O 응답을 기다릴때 I/O 작업에서 응답이 늦어 시스템 처리 속도가 느려지는 경우이다.
- 높은 CPU 사용률: 시스템이 느려지거나 멈추었을때 초기에 해볼수 있는 조치로 CPU 사용률을 보는 것이다. JVM 프로세스의 스와핑을 판단해 보는 방법도 있다. 스레드별 CPU 사용률을 체크한 후, 스레드 덤프를 추출한다.