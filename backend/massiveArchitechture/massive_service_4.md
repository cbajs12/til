# 대용량 서비스 레퍼런스 아키텍처

## OAM layer
- 서비스할 때 시스템의 운영자 입장에서 필요한 관리 및 모니터링 기능을 제공한다.

### CMDB
- 여러 인스턴스로 구성되는 분산 시스템이나 여러 컴포넌트로 조합된 시스템을 구축할 때는 각 컴포넌트와 인스턴스에 대한 설정 정보를 저장하기 위한 공용된 DB가 필요한데, 이럴 때 사용하는 것이 CMDB이다.
- ZooKeeper는 적은 양의 데이터를 구조화된 형태로 저장하면서 빠른 액세스를 제공하고, 값이 바뀌는 것에 대해 이벤트 트리거 기능을 제공하여 어떤 설정값이 바뀌었을 때 이에 대한 특정한 액션을 취할 수 있도록 해준다.

### 모니터링
- 시스템의 건전성을 확인하고 장애에 대한 전조를 인식하여 대응할 수 있게 하며, 장애 발생 시 이를 추적하는 데 근거가 되는 데이터를 제공
- Infrastructure: 서버, 스위치, 디스크등의 실제 하드웨어 인프라에 대한 모니터링을 지원, 이러한 인프라는 SNMP라는 표준 프로토콜을 이용하여 모니터링이 가능하다.
- DBMS: 데이터베이스에 대한 모니터링을 하기 위한도구로, 대부분 DB솔루션에서 제공한다.
- Middleware: 톰캣과 같은 애플리케이션 서버나 Rabbit MQ등의 미들웨어가 있고, 모니터링은 대부분 해당 제품에 포함된 경우가 많다.
- Application: 일반적으로 개발자가 해당 애플리케이션에 맞게 개발하는 경우가 많다. 애플리케이션 서버 위에서 동작하는 제품의 경우 애플리케이션 서버와 애플리케이션을 함께 모니터링해주는 제품으로 APM이라는 제품군이 있다.

### 로그관리
- 시스템에서 발생하는 모든 행위에 대한 기록
- 시스템 로그: OS에서부터 RDBMS 등과 같은 미들웨어에서 올라오는 로그를 말한다. 시스템의 문제가 발생했을 때 장애의 원인 파악을 위해서 필요하며, 튜닝을 위한 기초 자료등을 위해서도 필요하다.
- 애플리케이션 로그: 애플리케이션의 장애 원인 파악이나 디버깅을 위해서 생성되는 로그, 애플리케이션 단에서 발생하는 에러나 경고 수준의 로그등은 애플리케이션을 수정하기 위해서 꼭 필요하다.
- 비즈니스 로그: 사용자의 서비스 사용형태, 거래 기록을 이용한 감사등을 이용해서 애플리케이션에서 인위적으로 찍어내고 수집하는 로그를 정의
- Flume과 같은 분산 로그 시스템을 사용하는 방법도 있으나, 대용량 분산 큐(Kafka) 등을 이용해서 로그를 한 곳에 수집해서 HDFS과 같은 대용량 파일 시스템에 저장하는 사례가 많다. 원활한 검색을 위해서 시스템 로그들은 Elastic Search등에 로그를 저장하여 쉽게 검색하기도 한다. 수집을 하는 방법은 파일을 주기적으로 FTP로 끌어 오거나  Log4J와 같은 Log Appender를 이용해서 직접 수집 시스템에 연결하거나 DBMS등에 쓴 로그를 주기적으로 긁어 오는 방법등이 있다. 다양한 소스로부터 로그를 수집하기 위해서 LogStash등이 있다.
- 저장된 로그를 ETL을 이용하여 OLAP에 넣고 분석을 하거나 하둡을 이용하여 데이터를 분석하는 배치 기반의 분석방법이 있고, Storm/Spark등을 이용하여 실시간으로 로그를 분석하는 방법이 있다.
- 애플리케이션 로그의 경우에는 경고나 에러 로그가 난 것을 인지해야 하고, 에러의 내용이 무엇인지 찾아낼 수 있어야 한다. 이러한 것을 이벤트성 로그라 한다.
- 같은 형태의 로그인 경우에는 중복 발생한 횟수를 분석해서 발생 비율등을 판단할 필요가 있다.
- 시스템 로그는 모아서 저장하고 나중에 검색하거나 전체 로그의 추이를 모니터링 할 필요가 있다. (LogStash + Kibana + Elastic Search 조합이 대표적, Logstash를 이용하여 다양한 시스템 로그를 수집후 Elastic Search에 저장한다 그리고 Kibana를 이용해서 시각화 한다. Elastic Search를 이용한 로그 검색 기능을 제공하여서 장애 발생시 로그를 빠르게 찾을 수 있다.)

### Configuration 관리
- 개발된 애플리케이션을 서버에 배포하는 모듈
- 애플리케이션에 대한 배포뿐만 아니라 이를 지원할 하드웨어 인프라나 미들웨어까지도 자동으로 배포해주는 자동화 툴이 존재한다.

## 클라우드 인프라
- 서버나 네트워크, 스토리지와 같은 컴퓨팅 자원을 언제 어디서든 원격의 공유된 풀에서 필요한 경우 요청하여 필요한 만큼 사용하는 모델이다.
- 클라우드 컴퓨팅은 자동화된 환경에서 필요한 수의 서버, 네트워크등을 신청해서 필요한 만큼 사용하고 반납하는 형태의 서비스이다.

### 클라우드 컴퓨팅의 분류
- private cloud: 서비스 사용자가 기업 내부의 비즈니스 시스템을 위해서 자체적으로 클라우드 플랫폼을 구축하는 모델, 클라우드 플랫폼이 회사 내부 또는 서드파티 데이터 센터에 독립적으로 구축
- public cloud: 서비스 제공자가 클라우드 서비스를 제공하기 위한 플랫폼, 리소스 사용량에 따라 과금되는 형태, 모든 리소스는 다른 사용자와 공유됨
- hosted private cloud: 서비스 사용자가 기업 내부의 비즈니스 시스템을 서비스 제공자의 퍼블릭 클라우드 플랫폼을 인프라로 사용하여 구축하는 모델

### 쿨라우드 컴퓨팅의 서비스 단계에 따른 분류
- IaaS: IT 서비스를 제공하기 위한 주요 인프라 자원을 공유 자원 형태로 관리하고 이를 나눠서 제공하는 형태의 서비스, 서비스 사용자는 이러한 인프라 위에 리소스를 할당받아 OS와 미들웨어를 설치하여 서비스를 이요하는 방식, AWS와 Azure등이 있다.
- PaaS: IaaS가 OS를 설치하기 위한 하드웨어 가상화 환경을 제공하는 것이라면, PaaS는 IaaS에 한 계층을 올려서 소프트웨어를 개발할 수 잇는 플랫폼을 제공하는 환경을 의미, 특정 컴퓨터 언어가 구동할 수 있는 미들웨어 및 DB, 오픈 API 형태로 미리 구현된 서비스 라이브러리를 제공함으로써 애플리케이션을 개발할 수 있도록 지원, AppEngine 서비스와 Heroku등이 있다.
- SaaS: 클라우드 서비스의 추상화 중 가장 상위 계층을 차지하는 분류로, 소프트웨어 서비스를 제공하는 형태의 클라우드 서비스이다. 이메일, CRM등의 완성된 형태의 애플리케이션을 서비스 받는 형식으로, 사용자는 애플리케이션의 사용량에 따라서만 비용을 지불하고 그 외의 부분에 대해서는 관리를 하지도 비용도 지불하지 않는다. 지메일과 MS Office 365서비스등이 있다.

### 장단점
- 장점으로는 복잡한 구성이나 설정을 할 필요없이 쉽고 빠르게 구성하고, 쓴 만큼 돈을 내기 때문에 초기 투자비용이 저럼하다 그리고 무제한적인 확장성을 가지고 있다.
- 단점으로는 서비스 사용비용이 생각보다는 싸지 않다. 비용관리를 해야한다. 클라우드는 다른 사용자와 인프라를 공유해서 사용하기 때문에 성능이 생각보다 떨어진다. 또한 성능 제약 때문에 실제 구성하는 아키텍처 역시 다른 형태를 가져야하며, 생각보다 많은 제약이 있기 때문에 다른 접근 방법이 필요하다. 절대적인 성능을 예측할 수 없으며, 장애가 날수도 있기 때문에 불안정하다.

## 글로벌 서비스 아키텍처
- L10N: 지역화로써, 소프트웨어를 그 지역에 맞게 지역화하여 수정하는 것을 의미, 언어를 그 국가에 맞추는 것은 물론이고, 키보드 입력 체계등을 나라에 맞게 변경해야 한다.
- I18N: 국제화로써, 소프트웨어가 동시에 여러 지역화를 지원할 수 있는 구조로 되어 있는 것을 정의한다.