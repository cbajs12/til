# 종단 간 프로토콜
- 호스트 간 패킷 전달 서비스를 프로세스 간 통신 채널로 바꾸는 것, 종단 애플리케이션 프로그램 간의 통신을 지원하기 때문에 `종단 간 프로토콜`이라 한다.
- `트랜스포트` 단계에서 진행이 된다.

### 트랜스포트 프로토콜이 제공해야할 성질
- 메시지의 성공적인 전달 보장
- 전달되는 순서로 메시지 전달
- 각 메시지의 사본을 최대 한 번만 전달
- 임의의 큰 메시지라도 지원
- 송신자와 수신자 간의 동기화 제공
- 수신자가 흐름제어를 송신자에게 적용할 수 있도록 허가
- 각 종단 호스트 상에서 다중 애플리케이션 프로세스 지원

### 트랜스포트 프로토콜이 동작하는 기반 네트워크의 한계
- 메시지의 전달 취소
- 메시지의 재정렬
- 메시지의 재전달
- 메시지의 크기 제한
- 메시지의 임의적인 전달 지연
- 이와 같은 네트워크는 `최대 노력` 서비스를 지원한다고 한다.

## 단순 역다중화
- 단순한 트랜스포트 프로토콜은 기반 네트워크의 `호스트 간 전달` 서비스를 `프로세스 간 통신` 서비스로 확장하는 것이다.
- 한 호스트 상에는 많은 프로세스가 실행될 수 있으므로 프로토콜은 각 호스트에 역다중화 단계를 추가하는 것이 필요하다. 이럼으로써 각 호스트의 다중 애플리케이션 프로세스는 네트워크를 공유할 수 있게 된다. 
- 트랜스포트 프로토콜은 기반 네트워크에서 제공하는 최대 노력 서비스에 대하여 다른 어떤 기능도 추가하지 않는다. `UDP`는 트랜스포트 프로토콜의 한 예이다.
- 목적 프로세스를 식별하기 위하여, OS가 프로세스에게 할당한 pid로 상대 프로세스를 직접 식별하는 것이 가능하지만 이러한 방법은 폐쇄적인 시스템안에서만 가능하다. 일반적인 방법은 ASP와 UDP를 모두 사용하여 프로세스에게 `우편함`이나 `포트`라고 하는 추상 위치 추적자를 사용하여 각자를 간접적으로 식별하는 방법이다. 기본적인 발상은 발신지 프로세스가 특정 포트로 메시지를 보내고, 목적지 프로세스가 이 포트로부터 메시지를 받는 것이다.
- 역다중화 기능을 구현한 종단 간 프로토콜의 헤더 부분은 일반적으로 메시지의 송신자와 수신자를 위한 식별자 또는 포트번호를 포함하게 된다.
- 하나의 프로세스는 어떤 특정 호스트 상에서 포트번호에 의하여 식별된다. 따라서 `<포트번호, 호스트>`는 UDP 프로토콜을 위한 역다중화 키를 구성하기 위해 사용될 수 있다.
- 클라이언트는 서버에게 이미 잘 알려진 포트번호를 할당하고, 이 포트를 통해 메시지를 접수하게 한다. 각 서버는 이미 공고된 고정된 포트번호를 통해서 메시지를 수신한다. 예를 들어 DNS의 포트번호는 53이다.
- 이러한 포트번호 매핑작업은 RFC를 통하여 주기적으로 알려지게 되며, 대부분의 UNIX상에서는 `/etc/service` 파일에 매핑이 정해져 있다.
- 이미 정해진 한 포트는 통신의 시발점이 되는데, 클라이언트와 서버는 이 포트를 사용하여 이후의 통신에 쓰일 임의의 포트를 약속하게 된다. 따라서, 이미 정해진 포트는 다른 클라이언트를 위해 비워 두게 된다.
- 클라이언트는 어떤 서비스든지 잘 알려진 포트를 통하여 `Port Mapper`에게 통신하는 데 사용되는 포트를 요청하는 메시지를 전송한다. 그리고 port mapper는 적당한 포트번호를 리턴하게 된다. 이러한 방법은 동시에 다른 서비스들과 관련된 포트를 변화시키거나 각각의 호스트가 같은 서비스를 다른 포트를 통하여 사용하는 것을 쉽게 한다.
- 포트의 구현은 OS에 따라서 여러가지 방식이 있다. `소켓 API`이 그 예이다. 일반적으로 포트는 메시지 큐로 구현된다. 메시지가 도착하면 UDP와 같은 프로토콜은 이 메시지를 큐의 끝에 넣고, 큐가 다 차게 되면 이후에 도착한 메시지는 거부된다. 이때 송신자에게 전달속도를 줄이라는 흐름제어 기법이 따로 제공되지 않는다. 프로세스가 메시지를 수신할때 큐의 앞단 메시지를 꺼내며, 큐가 비어있으면 프로세스는 메시지가 도착할 때까지 블록상태가 된다.
- UDP가 흐름제어나 신뢰성 있고 정렬된 전달을 보장하지 않지만, 여러 프로세스에게 간편한 방식의 역다중화 메시지를 제공하며, 체크섬을 사용함으로써 메시지의 정확성을 보장하게 된다. 현재 IPv4는 UDP 체크섬은 옵션이나 IPv6에서는 필수가 될 예정이다.
- UDP는 UDP 헤더와 메시지 본문, `의사헤더`라고 하는 것에 체크섬을 연산한다. 의사헤더는 IP 헤더에 있는 세가지 필드로 구성된다. 길이, 발신지 IP 주소 그리고 목적지 IP 주소이다. 또한, UDP는 IP와 동일한 체크섬 알고리즘을 사용한다.
- 의사헤더를 가지는 이유는 해당 메시지가 정확하게 두 종단점 사이에 전달되었는가를 확인하기 위해서이다.
