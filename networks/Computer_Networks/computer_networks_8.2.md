# 네트워크 보안

## 키 사전분배
- 암호기법과 인증인자를 사용하기 위하여 통신 참여자는 어떤 키를 사용할지를 알고 있어야 한다.
- 세션 키는 단일한 그리고 짧은 기간의 통신 단위(세션)의 보안을 위하여 사용된다. 양 참여자는 간의 각 세션들은 새로운 키를 사용한다. 이 키는 일반적으로 속도가 빠른 대칭 키를 이용한다. 참여자는 프로토콜을 통해 어떤 세션 키를 사용할지를 결정한다. 이 프로토콜을 세션 키 설정 프로토콜이라 한다. 세션 키 설정 프로토콜은 자신을 위한 보안이 필요한데 이 보안은 장기적인 사전분배 키를 기반으로 한다.
- 보안에서 세션 키와 사전분배 키를 구분하는 3가지 요인이 있다. 첫째는 키가 사용되는 기간을 제한하는 것은 집중적인 계산이 필요한 공격에 적은 시간을, 암호파괴자에게 적은 암호문을, 그리고 키를 해독하는 데 필요한 정보를 적게 노출하는 효과가 있다. 두번째는 대칭 키의 사전분배는 문제의 소지가 있다. 마지막으로 공개 키 암호기법은 일반적으로 인증과 세션 키 확립에는 효과적이다. 그러나 기밀성을 위해 전체 메시지를 암호화하기에는 너무 느리다.

### 공개 키의 사전분배
- 공개 키 암호기법을 사용하려면 자신의 공개 키와 개인 키의 쌍을 생성한 다음 개인 키는 감추어 두고 공개 키는 공개하면 된다.
- 공개 키와 본임증명의 연계를 증명하는 완전한 구조를 `공개 키 기반구조(PKI)`라 한다. PKI는 본인임을 검증하고 이들을 키에 연계하는 기능을 통신 외부에서 시작한다. 통신외부란 네트워크나 여기에 연동되는 시스템과는 분리된 외부의 어떤 것을 의미한다.
- 통신외부에서 키를 설정하는 방식은 확장성은 없으나 PKI를 처음 시작하는 정도로는 충분하다. 공개 키를 알고 있다는 것을 디지털 서명과 신뢰라는 개념을 활용하여 넓게 확정성 있게 확산될 수 있다.
- 공개 키 연계에 대한 디지털 서명된 문서를 `공개 키 인증서`라고 한다. 
- 예로, 내가 bob의 공개 키를 통신 외부 방식으로 받았고, 또한 bob을 키와 증명서를 통해서 신뢰를 할수 있다면 bob이 보낸 alice에 대한 공개 키를 신뢰를 기반하여 믿을 것이다. alice에 대한 사람을 모르더라도 bob에 대한 신뢰를 기반으로 alice의 공개 키를 알수 있게 된다. 누군가가 alice의 공개 키를 검증하려면 그가 bob을 신뢰하고 그의 공개 키를 알고 있다면 그는 공개키 인증서의 사본을 구해서 검증할 수 있다.
- 인증서에 대한 주요 표준 중 하나는 X.509로 알려져 있다.  이 표준은 많은 상세 사항은 남겨두고 기본적인 구조만 기술하고 있다. 인증서에는 인증될 개체의 본인 증명, 인증될 개체의 공개 키, 서명자의 본인 증명, 디지털 서명, 디지털 서명 알고리즘 식별자이다. 선택 사항으로 이 인증서의 유효기간이 있다.
- 인증서는 인증될 것을 위하여 잘 정의된 이름 공간이 사용되어야 한다. 예를 들어, 인증서는 이메일이나 DNS에 대하여 발행된다.

#### 인증 기관
- 신뢰의 모델에서 신뢰란 신뢰하냐 신뢰하지 않느냐의 문제이다. 인증서를 이용하여 신뢰의 고리를 형성할 수 있다. X가 Y를 신뢰하고 Y가 Z를 신뢰한다면 X가 Z를 신뢰할수 있다는 것이다.
- 인증 기관(CA)이란 본인 증명과 발행된 공개 키 인증서를 검증하는 데 신뢰할만하다고 선언된 개체이다. CA를 이용하기 위해서는 그의 키를 알아야 한다. 어떠한 CA로 시작하여 CA들이 서명한 신뢰의 고리를 입수한다면 새로운 CA의 키도 알게 될 것이다. 이러한 고리를 형성하는 일반적인 방식은 트리 구조의 계층으로 정리하는 것이다. 누구나 루트 CA의 공개키를 알고 있다면 어느 참여자도 다른 참여자에게 인증서의 고리를 제공해 줄 수 있다.
- 다른 방식으로는 공개 키가 잘 알려져 있는 다수의 CA가 있을 수 있다. 기록용 장비로서 이런 CA는 자신의 인증서에 포함된 바로 그 키로 서명한 자신의 인증서를 생성할 수 있다. 이를 `자체 인증 인증서`라 한다. 여러 브라우저는 여러 개의 CA들의 자체인증 인증서를 미리 장착하고 있다. 이 인증서는 보안 웹의 처리에서 자주 사용되는 SSL/TLS 프로토콜에 적용되고 있다.
- 신뢰의 고리를 형성하는 데는 중요한 문제가 남아 있는데, 먼저 루트 CA의 공개 키를 알고 있다고 확신하더라도 이 루트 CA에서 아래로 연결된 모든 CA가 적절하게 운용되는지를 확인할 필요가 있다. X.509 인증서는 차례로 인증할 수 있는 신뢰를 가진 개체의 수를 제한하는 옵션을 제공하고 있다.

#### 신뢰의 웹
- 신뢰의 다른 모델은 Pretty Good Privacy(PGP)로 예시되는 `신뢰의 웹`이다. PGP는 이메일의 보안 시스템이므로 이메일 주소를 본인 증명으로 사용하고, 이 본인 증명에 키가 연계되고, 인증서는 이 연계에 대하여 서명된다. 정부의 개입을 차단하면서 PGP의 루트를 유지하기 위하여 CA를 사용하지 않는다. 대신 각 개인은 누구를 신뢰하는지 그리고 얼마나 신뢰하는지를 결정해야 한다. 이 모델에서 신뢰란 정도의 문제이다. 부가적으로 공개 키 인정서는 이 인증서에서 제시하는 키 연계를 서명자가 얼마나 확신하는지에 대한 확신의 정도를 포함한다. 어떤 사용자가 신뢰하기 위해서는 동인한 키 연계에 대한 여러 개의 인증서들을 참조해야 한다.
- 예를 들어, 내가 alice가 제공한 bob의 인증서를 가지고 있을때 다른 사람들로 부터 bob에 대한 추가적인 인증서를 받을 수 있다면 내가 보유한 bob의 공개 키가 유효하다고 확신하는 정도를 높일 수 있다.
- PGP는 신뢰를 구축하는 문제를 완전히 개인적인 문제로 인식하며, 사용자들이 CA들의 단일한 계층구조에 의지하기보다는 그들 자신이 스스로 결정할 수 있는 기초적인 자료를 제공해 준다.
- PGP는 네트워크 공동체 내에서는 널리 사용되고 있으며, PGP 키 서명 모임에서 각 개인은 신분을 알고 있는 사람들로부터 공개 키를 수집하고, 자신의 공개 키를 그들에게 제공하고, 다른 사람들이 서명한 자신의 공개 키를 얻고(더 많은 사람들에게 높은 확신을 얻을 수 있는 인증서를 수집), 다른 개인의 공개 키에 서명을 해주어 그들이 그들의 공개 키를 분배하는 데 사용할 인증서의 개수를 늘리는 것을 도와 준다. 마지막으로 키에 서명할 정도로 신뢰하고 있는 개인들의 인증서를 수집한다.

#### 인증서 폐기
- 폐기에 대한 기본적 해결책은 간단하다. 인증기관은 폐기된 인증서들의 리스트를 전자적으로 서명한 `인증서 폐기 리스트(CRL)`를 발급할 수 있다. CRL은 주기적으로 갱신되어 일반에 공개된다. 전자적으로 서명이 되어 있기 때문에 기시판에도 게시될 수 있다. 만약 alice가 bob의 인증서를 검증하고 싶다면, 먼저 CA에 발급된 최근 CRL을 참조할 것이다. 리스트 안의 폐기된 인증서들은 인증서의 유효 기간만큼 존재하다가 유효 기간이 지나게 되면 삭제된다.
- CRL의 특정 결함을 극복하기 위하여 `온라인 인증서 상태 프로토콜(OCSP)`이 개발되었다. OCSP는 인증서의 유효성을 검사하기 위하여 `OCSP 답변자`라 불리는 OCSP 서버와 혹은 서버들 간의 통신에 사용된다.

### 대칭 키의 사전 분배
- alice가 비밀 키 암호기법을 통해 bob과 통신하려면 alice는 단순히 키를 선택하고 이 키를 bob에 보낼 수는 없다. 그 이유는, 이미 가지고 있는 키가 없다면, 이 키를 기밀성을 유지하기 위하여 암호화할 수도 없고 상호 인증할 수단도 없기 때문이다. 공개 키의 경우와 마찬가지로 어떤 사전 분배 구조가 필요하다.
- 대칭 키의 사전분배는 2가지의 이유로 공개 키보다 어렵다. 첫째, 인증이나 기밀성을 위하여 각 개체마다 하나의 공개 키로도 충분한 반면에 통신하고자 하는 각 개체의 쌍마다 하나의 대칭 키가 필요하다. N개의 개체를 위하여 N(N-1)/2개의 키가 필요하다. 둘째, 공개 키와 달리 비밀 키는 비밀이 보장되어야 한다. 결론적으로 더 많은 키가 분배되어야 하며 누구나 읽을수 있는 인증서를 사용할 수도 없다.
- 일반적인 해법은 `키 분배 센터(KDC)`를 이용하는 것이다. KDC는 개체 상호 간에 비밀 키를 공유하는 신뢰할 수 있는 개체이다. 이 방식은 필요한 키의 개수를 관리 가능한 수준인 N-1개로 감소시킨다. 이 개수는 일부 애플리케이션에서 통신 외부 방식으로도 가능할 정도로 적은 수이다. alice와 bob과 통신할 때는 이 통신이 KDC를 거치지 않는다. 반면에 KDC는 alice와 bob을 인증하는 프로토콜에는 참여한다. 이 프로토콜은 이들과 이미 공유하고 있는 키를 이용하여 이들이 사용할 새로운 세션 키를 생성해 준다. 그러면 alice와 bob은 이들의 세션 키를 이용하여 통신한다. Kerberos는 이 기법에 기반을 둔 시스템이다.
