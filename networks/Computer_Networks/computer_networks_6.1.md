# 혼잡제어와 자원할당
- 공유자원으로는 링크의 대역폭과 버퍼가 있다. 버퍼는 라우터와 스위치의 링크를 통해 전달되기를 기다리는 패킷이 큐로 보관되는 장소이다. 
- 패킷은 링크를 통해서 전달될 차례를 기다리며 큐에 보관되는데, 링크를 사용하기 위해서 라우터에서 경쟁하기도 한다. 특히, 많은 패킷이 하나의 링크를 사용하기 위해서 경쟁하는 경우 큐는 포화 상태가 될 수 있으며 일정 수 의 패킷은 전달이 취소 되기도 한다. 네트워크가 이러한 상태에 있을 때, 혼잡 상태라고 하며 이를 해결하기 위해 혼잡 제어 기법을 사용한다. 혼잡 제어와 자원 할당은 서로 동전의 앞뒤와 같은 양면성을 가지고 있다. 
- 이를 해결할 한가지 방법은 특정 주기의 시간 동안 할당된 물리적 링크를 어느 가상 회선이 사용하는가를 스케줄링하는 것과 같이 네트워크 자원 할당에서 능동적인 역할을 수행한다면 혼잡 상태는 피할 수 있으며, 혼잡 제어 기법은 불필요하게 된다. 그러나 혼잡 상태를 방지하도록 정확하게 네트워크 자원을 할당하는 것은 매우 어렵다. 왜냐하면 고려해야 할 자원이 네트워크 전반에 걸쳐 분포하고 있기 때문이다. 즉, 일련의 라우터에 연결된 여러 링크가 스케줄링될 필요가 있기 때문이다. 
- 다른 한 가지 방법은 항상 원하는 만큼의 패킷을 전달할 수 있도록 허락하고, 이후 혼잡 상태가 발생하면 다시 복구시키는 방법이 있다. 이러한 방법은 앞의 방법보다 훨씬 쉽게 구현할 수 있으나, 혼잡 상태에서 복구되는 동안 많은 패킷이 네트워크에서 전달 취소될 수도 있기 때문에 하나의 전달 자체가 실패하는 경우가 있을 수 있다. 게다가, 네트워크가 혼잡 상태일 때, 즉 자원이 요구보다 상대적으로 적게 될 때 경쟁하는 사용자 사이에 자원 할당의 요구는 더 날카롭게 느껴진다.
- 두 가지 방법을 혼용하는 방법도 있다. 즉, 자원 할당을 위한 스케줄링이 부정확한 경우 혼잡 제어는 발생할 가능성이 있고, 따라서 이러한 혼잡 제어를 위한 어떤 기법이 존재할 필요가 있다.
- 혼잡 제어와 자원 할당은 두 호스트와 라우터 같은 네트워크 요소를 포함한다. 네트워크 요소에는 어떤 패킷을 전송하고 어떤 패킷은 버릴 것인지에 대한 순서를 제어하기 위해서 다양한 큐잉 정책들이 사용된다. 또한 큐잉 관리 기법은 전달될 패킷들의 트래픽을 분산시키는 데 간접적인 영향을 끼친다. 즉, 한 사용자의 패킷을 전달하는 것이 다른 사용자의 패킷을 전달하는 데 불법적 침범을 막아 주게 된다.
- 종단 호스트에서의 혼잡 제어 기법은 패킷을 보낼 수 있는 속도와 보조를 맞춤으로써 이루어진다. 이러한 보조를 통해 혼잡 상태가 발생된 첫 번째 장소인 종단 호스트에서는 자신의 전달속도를 줄임으로써 혼잡 상태를 제거하는 데 도움을 주게 된다.

## 자원 할당의 쟁점
- 자원 할당 및 혼잡 제어를 매우 복잡하게 하는 한 가지 요소는 프로토콜 계층 구조가 단 하나의 독립적인 단게로 분리되지 않는다는 점이다. 자원 할당은 네트워크 안에 있는 라우터나 교환기에서 그 일부가 구현되며, 종단 호스트에서 수행되는 트랜스포트 프로토콜에서 나머지 일부가 구현된다. 종단 시스템은 자원의 유용성에 대한 정보로서 반응하기 위한, 네트워크 노드들의 자원 요구를 전달하기 위해서 시그널링 프로토콜을 사용한다.
- 자원 할당은 네트워크 요소들이 애플리케이션에서 경쟁적으로 요구하는 네트워크 자원에 대처하기 위한 과정을 의미한다. 자원 할당은 누구에게 할당하고 누구에게 할당하지 않을지를 결정하는 문제이다.
- 혼잡 제어는 네트워크 노드들이 과부하 조건을 방지하고 대응하기 위한 노력의 일환이다. 혼잡은 일반적으로 좋지 않은 것이므로 첫 번째 해야할 일은 혼잡을 진정시키거나 최초의 장소에서 혼잡을 방지하는 것이다. 혼잡 제어 기법은 공평성의 개념을 갖는 것이 일반적이다. 즉, 소수의 사용자들에게 커다란 불편을 주는 것이라기보다는 모든 사용자들이 불편을 공유해야 한다는 것이다. 그러므로 많은 혼잡 제어 기법들은 그 안에서 이루어지는 자원 할당의 개념을 가질 것이다.
- 흐름 제어는 빠른 송신자의 과도한 송신으로부터 느린 수신자를 보호하는 역할을 포함한다. 이와는 반대로 혼잡 제어는 어떤 한 부분의 자원 부족으로 인해 송신자가 네트워크 상에 많은 데이터를 보내지 못하도록 하는 방법을 사용한다.

### 네트워크 모델

#### 패킷 교환망
- 어떤 환경에서 개별 발신지가 임의의 전달 링크의 전달 용량보다 많은 패킷을 보낼 수 있다고 하자. 그렇다면 전달 도중 네트워크 상의 어디에선가 다른 여러 발신지가 전달하는 패킷과 만나게 된다.
- 전달속도가 큰 두 개의 링크가 전달속도가 작은 하나의 링크에 집중되면서 데이터는 라우터의 큐에서 대기하게 된다. 이러한 상황은 이더넷과 FDDI와 같은 공유 접근 네트워크와는 대조적이라고 할 수 있다. 이들 공유 접근 네트워크에서는 발신지가 네트워크 상의 전달량을 미리 살펴본 후 패킷을 보낼 것인가를 결정할 수 있기 때문이다. 접근 제어 알고리즘은 교환망의 혼잡 제어 알고리즘과 비슷하다고 할 수 있다.
- 혼잡 제어는 라우팅과 다르다. 혼잡한 링크는 경로전파 프로토콜에 의해서 큰 가중치를 부여받게 된다. 결과적으로 라우터는 혼잡한 패킷을 주위로 분산시킨다. 이를 `라우팅 분산`이라고 한다. 혼잡한 링크는 혼자서 혼잡 상태를 해결할 수 없다. 라우팅 분산이 불가능한 라우터가 있을 수 있으며, 이러한 라우터는 혼잡 상태가 발생될 수 있고 이러한 상황에 대해 라우팅 기법이 할 수 있는 일은 없다. 이 혼잡한 라우터를 `병목` 라우터라고 한다.

#### 비연결성 흐름
- 네트워크가 기본적으로 비연결성을 가진다고 가정한다. 즉, 종단 호스트는 트랜스포트 프로토콜에 의하여 구현되고 실행되는 어떤 종류의 연결성 서비스도 가지지 않는다고 가정한다. 이러한 가정은 인터넷의 정확한 모델이다.
- 인터넷에서 IP는 비연결성 데이터그램 전달 서비스를 제공하며, TCP는 종단 간 가상 회선 모델링을 구현한다. 그러나 X.25와 같은 초기 네트워크에서는 이러한 가정이 없다. 
- X.25에서는 가상 회선 모델링이 여러 라우터에 의해서 유지된다. 그러한 네트워크에서는 하나의 회선이 설정되었을 때 연결 설정 메시지가 네트워크를 모두 돌아다니게 되며, 이러한 연결 설정 메시지는 각 라우터에서 접속을 위한 일련의 버퍼를 예약하게 된다. 따라서 혼잡 제어를 위한 기초를 제공할 수 있게 된다. 하나의 회선 설정은 충분한 버퍼를 각 라우터에서 할당받을 수 있을 때만 가능하게 된다. 이 방식의 주요 단점은 자원의 이용률이 떨어진다는 것이다. 이미 특정 회선을 위해 예약된 버퍼는 현재 그 회선을 사용하고 있지 않더라도 다른 회선은 데이터 전달을 위해 그 버퍼를 사용할 수 없기 때문이다.
- 모든 데이터그램이 비연결성 특징을 가지는 네트워크에서 완전히 독립적이라는 가정은 과장된다. 데이터그램은 독립적으로 스위칭지만, 일반적으로는 특정 호스트와 이루어지는 데이터그램의 스트림은 목적지까지의 경로에 있는 특정 라우터에 의해서만 이루어지기 때문이다. 이러한 개념이 곧 `흐름`이라고 할 수 있다. 흐름은 발신지와 목적지에 있는 호스트에서 보내는 패킷들의 순서이며 네트워크 상에서 목적지까지의 경로에 있는 같은 라우터를 따라가게 된다. 흐름의 개념은 혼잡 제어에서 매우 중요한 추상 개념이다.
- 흐름 추상 개념의 효과 중 한 가지는 다른 입장에서 흐름들을 정의할 수 있다는 것이다. 예를 들어, 한 흐름은 같은 발신지/수신지의 호스트 주소를 갖는 종단 간 또는 같은 발신지/수신지의 호스트와 포트의 쌍을 갖는 프로세스 간에 존재할 수 있다. 또 다른 하나는, 한 흐름의 개념은 기본적으로 하나의 채널이라고 할 수 있다. 흐름이 네트워크 안에 있는 라우터에서 보는 것이라면, 채널은 종단 호스트에서 보게 되는 추상 개념이기 때문이다.
- 여러 관련된 패킷은 경로의 각 라우터를 통과하기 때문에 때로는 각 흐름에 대해서 상태 정보라는 것을 유지하는 것이 필요하다. 이들 정보는 그 흐름에 속한 패킷에 대해서 혼잡 제어를 위해 사용된다. 실제로는 네트워크의 동작이 정확히 상태 정보에 의존하지 않기 때문에 이 상태 정보를 `소프트 상태` 정보라고 하기도 한다.
- 소프트 상태 정보가 하드 상태 정보와 다른 점은 소프트 상태는 항상 명시적 생성이 필요하지 않고 시그널링에 의하여 제거된다. 소프트 상태 정보는 순수한 비연결성 네트워크에서는 라우터에서 어떠한 상태 정보도 관리하지 않는다는 것이며, 또한 연결성 네트워크에서는 각 라우터에서 하드 상태 정보를 관리하는 중간적인 입장을 나타낸다. 일반적으로, 이 상태 정보가 없어도 각 패킷은 정확하게 경로를 찾을 수 있다. 그러나 한 패킷이 속해 있는 흐름에 참여하는 라우터가 소프트 상태 정보를 관리하는 경우에는 그 라우터의 패킷을 더 효율적으로 관리할 수 있게 된다.
- 또한, 흐름은 명시적으로 생성되기도 하고 내재적으로 생성될 수도 있다. 내재적으로 생성되는 경우, 각 라우터는 한 발신지에서 한 목적지로 전달되는 패킷에 대해서 그 패킷의 헤더에 있는 주소를 조사, 관찰하여 같은 발신지와 목적지 주소를 가지는 패킷에 대해서는 혼잡 제어를 위해서 같은 흐름에 속하도록 처리하게 된다.
- 명시적으로 생성하는 경우에는 발신지는 네트워크 상에 흐름 설정 메시지를 보내게 된다. 이 메시지는 곧 일련의 패킷을 전달하기 위한 흐름이 시작됨을 알리는 것이다. 따라서 명시적인 흐름의 설정은 연결성 네트워크에서 나타내는 연결과 별로 다르지 않는다. 그러나 명시적으로 생성되었어도 흐름 자체가 종단간 규정을 의미하지는 않고, 특히 가상 회선이 신뢰할 수 있고 정렬된 순서로 전달된다는 것을 의미하지는 않는다.

#### 서비스 모델
- 최대 노력 서비스 모델에서 네트워크는 송수신기 간에 패킷이 속도나 정확성 면에서 완전히 똑같도록 보장하거나 흐름의 신뢰성을 보장할 수 없다.
- 패킷을 전달할 때 네트워크가 어떤 종류의 확실한 보장을 해주는 서비스 모델을 `다중 QoS`라 한다.

### 분류법

#### 라우터 중심 대 호스트 중심
- 자원 할당 기법은 두 가지 큰 그룹으로 나눌 수 있다. 하나는 네트워크 안에서, 즉 라우터나 교환기에서 혼잡 상태를 제어하는 방식이고 다른 하나는 네트워크의 종단 부분, 즉 종단 호스트의 트랜스포트 프로토콜 안에서 제어하는 방식이다. 그러나 네트워크 상의 라우터와 종단 호스트에서 모두 자원 할당에 참여하는 경우도 있으므로, 실질적인 관점은 자원 할당의 주도권이 어느 부분에 있는가에 달려 있다.
- 라우터 중심 혼잡 제어의 경우에는 각 라우터가 어느 패킷을 서비스할 것인가, 또는 어느 패킷을 전달 취소시킬 것인가를 결정하게 된다. 뿐만 아니라 네트워크를 통해 패킷을 전달하는 각 종단 호스트에게 네트워크의 조건을 관찰한다. 즉, 얼마나 많은 패킷을 보낼 수 있는지를 알려 주는 일도 하게 된다.
- 호스트 중심 혼잡 제어의 경우에는 종단 호스트는 성공적으로 전달할 수 있는 패킷의 양을 계속적으로 관찰하여 그에 따라 전달률을 조정하게 된다. 
- 그러나 두 가지 방식이 서로 배타적인 방법은 아니다. 혼잡 제어를 라우터가 주로 처리하도록 한 네트워크도 종단 호스트는 라우터가 보내 주는 메시지를 통해서 혼잡 제어에 참여할 수 있으며, 종단 중심 혼잡 제어가 이루어져도 라우터는 큐가 혼잡 상태가 되었을 때 어느 패킷을 전달 취소시킬 것인지를 결정하기 위한 어떤 종류의 혼잡 제어 기법을 가질 수 있다.

#### 예약 기반 대 피드백 기반
- 자원 할당 기법을 분류하는 두 번째 방법은 자원 할당이 예약 기반인지 피드백 기반인지에 따라서 분류하는 것이다.
- 예약 기반 시스템의 경우 종단 호스트는 한 흐름이 성립되었을 때 일정 양의 전달 속도를 네트워크에 요구하게 된다. 이때 각 라우터는 이 요구를 충족하기 위한 충분한 자원을 할당하게 된다. 즉, 해당 링크의 최대 대역폭에서 할당할 비율과 버퍼의 크기 등과 같은 자원을 미리 예약하게 된다. 전달경로 중의 어떤 라우터에서 용량 초과로 인해 이 요구가 만족될 수 없다면 그 라우터는 종단 호스트의 흐름을 거절하게 된다.
- 피드백 기반 시스템에서는 종단 호스트는 자원을 미리 예약하지 않고 데이터를 일단 전달하는 것으로 시작한다. 이후 라우터에서 보내 주는 피드백 정보에 따라 전달률을 조정하게 된다. 피드백 정보는 혼잡 제어 기능을 가지는 라우터가 전달 속도를 늦춰 달라는 메시지를 보내는 것처럼 명시적으로 오게 되거나 패킷 손실과 같은 정보를 통해 네트워크의 상태를 관찰함으로써 자신의 전달속도를 조절하는 방식과 같이 내재적으로 이루어질 수도 있다.
- 예약 기반 시스템은 항상 라우터 중심의 자원 할당 기법을 가져야만 한다. 왜냐하면 각 라우터는 현재 자신의 최대 용량 중 예약된 용량이 얼마나 되는지를 관리하며, 자원에 대한 각각의 예약이 특정 종단 호스트를 위해 전적으로 사용된다는 것을 보장하는 책임을 지기 때문이다. 한 종단 호스트가 미리 예약한 전달 속도보다 더 빠르게 데이터를 전달하게 되면 라우터는 자원 할당에 따라서 그 종단 호스트의 패킷을 전달 취소시키게 된다.
- 이와는 다르게 피드백 기반 시스템은 라우터 중심의 자원 할당 기법이나 종단 호스트 중심의 자원 할당 기법 중 어느 것도 채택할 수 있다. 일반적으로 피드백 정보가 명시적이라면 라우터가 어느 정도 자원 할당 기법에 참여하는 형태라고 볼 수 있지만, 내재적으로 피드백 정보를 얻는다면 종단 호스트에서 혼잡 제어의 대부분을 처리하는 형태라고 볼 수 있다. 따라서, 이런 경우 라우터는 혼잡 상태가 발생하면 무조건 패킷을 전달 취소시키게 된다.

#### 윈도우 기반 대 전달률 기반
- 자원할당 기법의 분류 중에서 세 번째 방법은 윈도우 기반인가 아니면 전달률 기반인가에 따른 분류 방법이다. 이는 흐름 제어 및 혼잡 제어의 유사한 기법과 용어에 대한 한 분야이다.
- 흐름 제어 및 자원 할당 기법은 둘다 고속의 방법을 요구하고, 송신자에게 얼마나 많은 데이터를 전달할 수 있는가를 알려 줄 필요가 있는데, 일반적으로 이를 위한 방법으로는 윈도우와 전달률이 있다.
- TCP에서는 수신자가 송신자에게 윈도우를 전달 전에 미리 알려 주게 된다. 이 윈도우는 수신자가 가지고 있는 버퍼의 크기와 같으며 송신자가 보낼 수 있는 데이터의 크기를 제한하게 된다. 즉, 윈도우는 흐름제어에 이용될 수 있다. 또한, 이와 같은 윈도우는 네트워크 상의 각 라우터에서 일정량의 버퍼를 예약하기 위해서도 사용될 수 있으므로 자원 할당에도 사용될 수 있다. 이런 기법은 X.25에서 기본적으로 사용되고 있다.
- 전달률을 통해서 흐름 제어나 혼잡 제어를 할 수 있는데 수신자나 네트워크가 1초당 받아들일 수 있는 데이터량을 알려 줌으로써 가능해진다. 즉, 송신자는 필요한 전달률을 지원하기 위해 예약을 하게 되며, 전달 경로에 있는 각 라우터는 관련 있는 다른 흐름들을 고려하여 그 전달률을 지원할 수 있는가를 결정하게 된다.

#### 자원 할당 기법 분류의 요약
- 8개의 기본적인 혼잡 제어 기법을 보았다 그러나 8가지의 기법이 가능하더라도 실제로는 최대 노력 서비스 모델과 예약 기반의 형태를 채택한 QoS 기반 서비스 모델이 가장 보편적인 기법이다. 이들 두 가지 기법은 네트워크의 기본적인 서비스 모델에 관련된다.
- 최대 노력 서비스 모델은 보통 피드백 기법이 사용된다. 왜냐하면 이런 모델은 사용자가 네트워크의 자원을 미리 예약하는 기법을 제공하지 않기 때문인데, 이는 곧 혼잡 제어의 책임이 대부분 종단 호스트에 있다는 것을 의미한다. 물론 어느 정도 라우터의 보조가 있을 수 도 있다.
- Qos 기반 서비스 모델은 보통 예약 기반을 채택하므로 라우터의 역할이 매우 중요함을 의미한다. 예를 들면, 큐의 패킷들은 그들이 요구하는 예약된 자원의 등급에 따라 다르다. 더욱이 전달률에 대해 예약하는 방식이 일반적인데, 이는 데이터 전달에 필요한 대역폭에 대하여 윈도우가 단지 간접적인 정보만을 알려 주기 때문이다.

### 평가 기준

#### 효과적인 자원 할당
- 자원 할당 기법의 효과적인 측정을 위한 측정 기준은 네트워크의 두 가지 주요 메트릭인 처리량과 지연시간이다.
- 처리량 향상을 위한 자원 할당 알고리즘의 한 가지 확실한 방법은 모든 링크에 대한 효율을 100%에 가깝게 하기 위해서 네트워크를 통해 가능한 많은 패킷을 보내는 것이다. 이를 위해서 유휴 링크는 성능 향상에 손실을 가져오기 때문에 유휴 링크의 발생을 되도록 피해야만 한다.
- 이러한 전략의 문제는 네트워크에서 패킷의 수가 증가함에 따라 각 라우터 큐의 길이가 증가해야 한다는 것이다. 즉, 큐가 길어진다는 것은 곧 네트워크 상에서 패킷의 지연시간이 더 증가됨을 의미한다.
- 혼잡 제어 기법의 효과를 평가하기 위한 메트릭으로 지연시간에 대한 처리율을 사용할 것을 제안했다. 이러한 비율은 네트워크의 `파워`(파워= `처리량/지연시간`)로 언급된다. 그러나 파워가 반드시 자원 할당 기법을 판단하는 옳은 메트릭이라고 확신할 수 없다. 또 한 가지 파워의 기본 이론은 무한 큐를 가정한 M/M/1 큐잉 네트워크(1은 하나의 서버만을 갖는 것을 의미하고, M은 패킷 도착, 서비스 시간이 지수적인 모양인 Markovian으로 분포되어 있음을 의미)에 기반하고 있다. 그러나 실제 네트워크는 유한 버퍼와 때때로 손실되는 패킷을 가진다. 또 다른 하나는 파워는 일반적으로 단일 흐름에 관련되어 정의된다. 파워가 여러 개의 경쟁관계에 있는 연결에 대해서 어떻게 확장되는지 확실치 않다. 그렇지만 파워는 여전히 사용중이다.
- 부하에 관한 지연시간당 처리량의 비율 곡선은 다중 프로그램 컴퓨터 시스템에서의 시스템 처리량 곡선과 흡사하다. 시스템 처리량은 너무 많은 일이 실행되어 쓰레시 상태가 되어 성능이 떨어지기 시작하는 지점에 도달할 때까지는 시스템 내부에 입되는 일이 많을수록 선능이 향상된다.
- 혼잡 제어 기법은 매우 미숙한 방법으로 부하를 조절할 수 있을 뿐이다. 결과적으로 네트워크 설계자는 시스템이 극도로 부하를 가지는 상황일때, 무슨일이 일어날지에 대해 고려해야 한다.
- 시스템이 안정한 상태에서는 네트워크가 매우 부하가 심한 상태에서도 패킷이 연속적으로 네트워크를 통과해 나갈 수 있게 된다. 혼잡 제어 기법이 안정적이지 않다면 네트워크에서 혼잡 충돌이 발생할 수 있다.

#### 공정한 자원 할당
- 예약 기반 자원 할당은 공정하지 않은 통제를 만드는 명시적 방법을 제공한다. 그러나 명시적 정보가 없는 경우, 특정 링크를 여러 개의 흐름이 공유할 때 각 흐름은 대역폭을 동등하게 나누어 사용할 것이다. 그러나 예약하지 않는 경우에 동등한 나눔은 공정한 나눔이 아니다.
- 공정성은 곧 똑같이 할당받음을 의미하며 모든 경로는 같은 길이를 가진다고 가정했을 때 Raj Jain은 혼잡 제어 기법의 공정성을 정량화 할 수 있는 `공정성 인덱스`를 제안했다.
