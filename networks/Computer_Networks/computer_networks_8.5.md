# 네트워크 보안

## 방화벽
- 방화벽이란 보호하고자 하는 사이트와 네트워크의 나머지 부분 사이의 유일한 연결 지점인 시스템이다. 이 시스템은 일반적으로 라우터의 일부분으로 구현된다. 개인용 방화벽의 경우 단말 사용자 장비에 구현되기도 하다. 방화벽 기반 보안은 외부로부터 사이트로의 유일한 연결을 제공하는 방화벽에 기반을 두고 있다. 그러므로 다른 게이트웨이나 무선 연결, 혹은 dialup 접속등을 통해 방화벽을 우회할 수 있는 방법이 없어야 한다. 방화벽은 사이트와 네트워크의 나머지 사이에서 메시지의 중계를 제한하는 접속제어 기능을 제공한다. 방화벽은 허용된 메시지만 포워드하고 허용되지 않은 메시지는 필터링한다. 예를 들면, 특정 IP 주소로 가는 모든 패킷 혹은 특정 TCP 포트 번호를 가진 모든 패킷을 선별적으로 필터링할 수 있다.
- 방화벽은 네트워크를 방화벽 내부의 신뢰하는 영역과 방화벽 외부의 신뢰하지 않는 영역으로 구분한다. 이는 외부의 사용자가 사이트 내의 특정 호스트나 서비스에 접근하는 것을 원하지 않을 경우 매우 유용하다. 방화볃은 특정 공격을 방지하거나 적대자가 방화벽 내부에 접근하는 데 성공했을 경우 손실을 최소화하기 위하여 외부로 나가는 트래픽에 대한 제한을 적용하기도 한다.
- 방화벽은 신뢰의 수준이 점차 높아지는 신뢰영역의 계층을 구성하기 위하여 여러 개의 신뢰 영역을 생성할 수 있다. 일반적인 구성은 3개의 신뢰 영역을 만드는 것이다. 내부 네트워크, 비무장 영역, 그리고 나머지 인터넷으로 구분한다. `비무장 영역(DMZ)`은 DNS나 이메일 서버와 같이 외부로부터의 접근이 필요한 서비스를 설치하는 데 사용된다. 내부 네트워크와 외부 세계에서 DMZ에 접근하는 것은 허용되지만 DMZ 내의 호스트에서 내부 네트워크로의 접근은 허용되지 않는다. 그러므로 적대자 DMZ 내의 호스트에 침투하는 데 성공하였다 하더라도 내부 네트워크로 접근하지는 못한다. DMZ는 주기적으로 깨끗한 상태로 복원시켜 주어야 한다.
- 방화벽의 필터는 IP, TCP, UDP, 그리고 그 외의 다른 정보를 기반으로 한다. 방화벽은 통과시키거나 통과시키지 않을 패킷을 지정하는 주소 테이블을 설정한다. 여기서 주소란 단지 목적지의 주소만을 의미하는 것은 아니다. 일반적으로 테이블의 각 항목은 발신지와 목적지 각각에 대한 IP 주소와 TCP의 포트 번호의 4개의 값으로 구성된다.
- 예를 들어, 방화벽이 `<192.12.13.14, 1234, 128.7.6.5, 80>`에 맞는 모든 패킷을 포워딩하는 것이 아니고 선별하기 위해서 설정되었다고 한다면, 이 기준은 호스트 192.12.13.14의 포트 1234에서 호스트 128.7.6.5의 포트 80으로 가는 모든 패킷을 선별한다는 말이다. 물론 선별하고자 하는 패킷이 전송하는 모든 발신지 호스트를 일일이 나열한다는 것은 현실성이 없다. 따라서 와일드카드로 기술될 수도 있다. 예를 들어 `< *, *, 128.7.6.5, 80>`은 어느 발신지 호스트에서 어느 포트를 통해 패킷을 보냈는지에 상관없이 128.7.6.5의 포트 80으로 가는 모든 패킷을 선별한다는 것이다. 이와 같은 주소 형식은 방화벽이 3계층 호스트 주소와 부가적으로 4계층 포트 번호를 기반으로 포워딩/필터링을 결정하도록 요구한다. 이러한 이유로 필터에 기반을 둔 방화벽은 `레벨 4 스위치`라 한다.
- 보안을 극대화 하는 설계 원칙은 명시적으로 허용된 패킷을 제외한 모든 패킷을 폐기하도록 방화벽을 설정하는 것이다.
- 많은 클라이언트-서버 애플리케이션은 클라이언트에게 동적으로 포트를 할당한다. 방화벽 내부의 클라이언트가 외부의 서버로 접근하면 서버의 응답에는 동적으로 할당된 포트 번호가 포함되어 있을 가능성이 있다. 이 경우에는 문제가 발생한다. 즉, 방화벽이 임의의 서버 응답 패킷을 허용하고 클라이언트가 요청하지 않은 유사항 형태의 패킷을 허용하지 않도록 설정 해야 하는 방법이 있어야 한다. 이 문제는 상태 없는 방화벽에서는 불가능하다. 이 경우에는 각 연결의 상태를 추적하는 상태 있는 병화벽이 요구된다. 동적으로 할당된 포트로 가는 수신 패킷들은 그 포트에 대응되는 연결을 통해 적법한 응답이 있었을 경우에만 허용되도록 한다.
- 최근의 방화벽들은 HTTP, Telnet, FTP와 같은 여러 가지 특정한 애플리케이션 프로토콜을 이해하고 이를 기반으로 필터링하기도 한다. 이런 방화벽들은 HTTP에서의 URL과 같이 해당 프로토콜의 특정한 정보를 이용하여 메시지를 폐기할 것인지를 결정한다.

### 방화벽의 강점과 약점
- 최선의 경우는 방화벽이 네트워크를 인터넷의 나머지 부분으로부터 원하지 않는 접근을 차단해 주는 것이다. 그러나 이는 방화벽의 내부와 외부 사이의 합법적인 통신에 보안을 제공하는 것은 아니다. 반대로 암호작성 기반의 보안 기법은 어느 곳에서나 어떤 참여자에게나 안전한 통신을 제공해 줄 수 있다. 그럼에도 방화벽이 널리 사용되는 이유는 암호작성 기반의 시스템은 통신의 양 말단의 지원이 요구되는 데 반하여 방화벽은 상용 제품을 사용하여 독자적으로 설치할 수 있기 때문이다. 방화벽이 널리 사용되는 근본적인 이유는 방화벽은 보안 문제를 집중화된 장소에서 통합적으로 처리하여 네트워크의 나머지 부분을 보안의 문제로부터 효과적으로 분리해주기 때문이다. 시스템 관리자가 보안을 제공하기 위하여 방화벽을 관리하고, 방화벽 내부의 사용자나 애플리케이션들은 보안의 걱정을 줄일 수 있다.
- 방화벽의 심각한 한계는 방화벽이 내부 사용자들 사이의 통신을 제한하지 못하므로 사이트의 내부 프로그램을 수행하는 수단을 가진 적대자는 모든 내부 호스트에 접근할 수 있다.
- 다른 문제점은 노출되어도 안전할 것처럼 보이는 서비스에 오류가 있을 경우 네트워크를 불안전하게 만든다. 전통적인 예가 PHP이다. PHP의 buffer-overflow 오류로 인하여 누구나 자신의 브라우저를 사용하여 PHP의 입력 창에 명령을 입력하는 방식으로 웹서버에서 임의의 명령을 수행하는 것이 가능하다.
- 방화벽에서 접근 가능하게 하는 의도하지 않은 오류 외에도 의도적인 오류도 있을 수 있다. Malware는 컴퓨터의 사용자가 원하지 않는, 숨겨진 방식으로 컴퓨터에서 수행되는 소프트웨어를 의미한다. 바이러스, 웜, 스파이웨어가 Malware의 일반적인 유형이다. 오류를 가진 소프트웨어의 경우와 같이 Malware도 반드시 수행 가능한 오브젝트 코드일 필요는 없다. 이것은 수행 가능한 인터프리터 코드가 될 수도 있다.
- 바이러스와 웜은 자신의 복제를 만들고 확산시키는 능력이 있는지에 따라 구분된다. 둘 간의 차이는 웜은 완전한 프로그램이고 바이러스는 다른 소프트웨어 일부분에 삽입되어 그 소프트웨어가 수행될 때 그 일부로서 수행되는 작은 코드를 의미한다. 바이러스나 윔은 자신들의 복제를 확산시키려고 시도하는 단지 부수적인 효과만으로도 네트워크의 대역폭을 소모하는 문제가 유발된다. 이것들은 백도어를 심을 수도 있다. 백도어란 일상적인 인증을 거치지 않고 시스템으로 원격 접속할 수 있도록 허용하는 소프트웨어이다.
- 스파이웨어는 권한이 없이 컴퓨터 시스템이나 사용자의 개인 정보를 수집하고 전송하는 소프트웨어이다. 일반적으로 스파이웨어는 유용한 프로그램에 비밀리 포함되어 이 사본을 의도적으로 설치하는 사용자들에 의해 확산된다. 방화벽의 문제는 이런 개인정보의 전송이 합법적 통신으로 간주된다는 것이다.
- Malware 방지 애플리케이션에서 사용하는 두 가지 방안 중 하나는 소프트웨어가 수행하면서 의심스러운 행동을 감시하는 방안이다. 물론 이 방안은 단말 사용자 장비에 설치되지 않은 방화벽에서는 불가능하다. 다른 방안은 Malware의 코드의 일부분을 검색하는 것이다. 이 방안을 방화벽 내에 구현하는 주요 문제점은 네트워크 성능에 영향을 주는 것이다.
- `서비스 거부(DoS)` 공격은 적대자가 합법적 사용자들이 접근권한을 가지고 있는 정보나 자원에 대하여 접근하지 못하도록 방해하는 공격이다. 잘 알려진 서비스 거부 공격은 TCP의 연결 설정을 위해 사용되는 패킷의 이름에 따라 SYN 공격이라 불린다. SYN 공격에서 원격 공격자는 대량의 SYN 패킷을 대상 기계로 쏟아 보낸다. 이 공격의 핵심은 단순히 의미 없는 데이터 패킷들을 대상 기계로 쏟아 보내는 것과 달리, SYN 패킷은 이 패킷이 버려도 괜찮다고 판단하기까지 상당한 처리를 요구한다는 것이다. 방화벽도 일정 수준의 보호를 제공한다. 이미 알려진 공격 호스트로부터의 모든 패킷을 버리도록 프로그램할 수 있으나, 공격자가 단순히 각 SYN 패킷의 발신지 IP 주소를 다른 것으로 바꾸기란 쉬운 일이다.
- 다른 DoS 공격은 일련의 '크리스마스 트리 패킷'을 라우터로 보내는 것이다. 즉, 패킷의 모든 가능한 옵션을 허용하여 보낸다는 의미이다. 라우터는 이들 모든 옵션들을 처리하는 데 대부분의 시간을 허비하게 되고, BGP update와 같은 중요한 작업을 못하게 될 수 있다.
- 또 다른 예로는 공격자는 연속된 일련번호를 주소로 하는 IP 패킷들을 ISP의 라우터로 플러딩한다. 이 연속된 주소는 라우터의 첫 단계 캐시를 넘치게 하고, 결국 라우터의 프로세서가 새로운 포워딩 테이블을 만드는 데 모든 시간을 낭비하도록 하는 결과를 초래한다. 이런 상황은 라우터가 이웃의 라우팅 정보 알림에 대하여 응답할 수 있는 시간을 고갈시켜 결국 이웃 라우터는 이 라우터가 죽었다고 믿도록 만드는 결과를 초래한다.
- DoS 공격으로부터 보호하는 것은 세 단계를 거친다. 첫째가 모든 사용자에 의하여 소비되는 모든 자원에 대하여 감시하는 것이다. 두 번째는 시스템 정책에서 허용된 이상을 소비하는 사용자를 탐지하는 것이다. 일단 공격이 탐지 되면 마지막 단계로 소비된 자원을 회수하되 가능한 적은 자원을 부가적으로 사용해야 한다. 그렇지 않으면 공격자의 제거 과정 자체가 DoS 공격의 원래 목적을 충족시켜 주는 결과가 된다.
- 일반적으로 자원 사용 정책을 위반한 것을 탐지하는 것은 매우 어렵다. 그 이유는 공격자가 반드시 동일한 발신지에서 대량의 공격 패킷의 흐름을 보낼 필요가 없기 때문이다. 대신에 공격자는 순수해 보이는 패킷의 흐름을 여러 발신지로부터 동시에 보내는 방법으로 공격하기도 한다. 이런 공격을 `분산 서비스 거부(DDoS)` 공격이라 한다. 이 공격에서는 대규모의 좀비 기계들의 집합을 구성하고, 이들 좀비들이 동시에 특정 사이트를 공격한다. 많은 발신지로부터 한꺼번에 몰려오는 과중한 합법적 트래픽과 DDoS를 구분하는 것이 거의 불가능하다.
