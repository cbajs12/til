# 네트워크 보안
- 상대방이 메시지 내용을 이해하지 못하게 방지하는 프로토콜을 `기밀성`을 보장한다고 한다.
- 통신의 목적지나 통신 상대의 수를 감추는 개념은 `트래픽 기밀성`이라 한다.
- 메시지에 대한 변경을 검출하는 기법을 `데이터 무결성`이라고 한다.
- 메시지의 추가적인 사본을 전송하는 것을 `재생 공격`이라 한다. 또한 이러한 답변을 검출하는 기법을 `원본성`이라 한다.
- 메시지를 지연시키는 전술을 검출하는 프로토콜을 `적시성`이라 한다. 데이터 무결성, 원본성, 적시성 등은 `무결성`의 일반적인 기능들의 일부로 간주된다.
- 현재 메시지를 주고 받는 상대가 정말로 원하는 상대인지를 보장해주는 프로토콜을 `인증`이라 한다.
- `접속 제어`란 누구에게 어떤 작업을 허용하는냐의 문제이다. 또한 많은 사용자들의 접속의 수준을 보장해 주는 것을 `활용성`이라 한다.
- `무거절`이란 거래에 대한 가짜 거부는 허가하지 않는 것을 의미하고, `불관용`이란 가짜 거래에 대한 보상청구를 의미한다.
- 네트워크를 구성하는 시스템에 보안을 부여하는 도구로는 암호작성과 방화벽이 있다.

## 암호작성 도구

### 암호기법의 원칙
- 암호화란 메시지를 변환하여 그 역변환을 하는 비밀을 가지고 있지 않은 상대방이 내용을 인식하지 못하도록 하는 기법을 말한다. 송신자는 원래의 평문 메시지에 암호화 함수를 적용하여 암호문을 메시지로 만든 다음 네트워크를 통하여 전송한다. 수신자는 비밀 암호해독 함수를 적용하여 원래의 평문을 복원하게 된다. 암호해독 함수에 의한 변환을 암호기법이라 한다.
- 암호화나 함호해독 함수는 키를 매개변수로 연계되고, 또한 이 함수는 공개된 지식이며 단지 키만이 비밀로 유지되어야 한다는 원칙이 확립되었다. 키를 바꾸면 본질적으로 암호기법을 바꾸는 것과 같은 효과를 갖게된다.
- 암호화 알고리즘의 기본적인 요구사항은 평문을 변환하여 오직 의도한 수신자들만 이 평문으로 복원할 수 있도록 하는 것이다. 이 의미는 키를 보유하지 않은 사람들은 이 암호화된 메시지를 읽지 못하게 한다는 의미이다.
- 가장 좋은 암호작성 알고리즘이란 개인이 평문과 암호문을 동시에 가지고 있더라도 키를 유추해내지 못하도록 하는 기법이다.
- 대부분의 암호기법은 블록 암호기법이다. 이는 일정한 고정 길이, 일반적으로 64~128 바이트 길이의 평문 블록을 입력받는다. 블록 암호 기법을 이용하여 각 블록을 독립적으로 암호화 한다. 이는 `전자 암호집(ECB)` 모드 암호화로 알려져 있다. 이 기법은 주어진 평문 블록 값에서 항상 같은 암호문 블록이 생성된다는 취약점을 가지고 있다. 따라서 평문 내에서 반복되는 블록 값은 암호문에서 반복되므로 쉽게 인식될 수 있다.
- 이를 방지하기 위해서 블록 암호기법은 블록의 암호문이 내용에 따라 변경되도록 변수화되어야 한다. 블록 암호기법이 변수화되는 방식을 작업모드라 한다. 작업의 일반적인 모드를 `암호 블록 체인(CBC)`이라 하는데 여기서 각 평문 블록은 암호화되기 전에 이전 암호문 블록과 XOR 연산을 한다. 이 결과로 각 블록의 암호문은 부분적으로 이전의 블록들에 종석적이 된다. 천 번째 평문 블록은 이전 블록이 없으므로 이는 임의의 값과 XOR된다. 이 임의의 값을 `초기 벡터(IV)`라 하고 이 값이 후속 암호문 블록들에 포함되어 첫 번째 블록이 해독되도록 해준다. 작업의 또 다른 모드는 `카운터 모드` 이 기법에서는 연속적인 값들이 평문의 연속적인 블록을 암호화하는 데 작용된다.

### 대칭 키 암호기법
- 대칭 키 암호기법에서 통신의 양쪽 참여자는 같은 키를 사용한다. 메시지가 특정한 키를 사용하여 암호화되면 동일한 키가 그 메시지의 암호해독에 사용된다는 의미이다. 대칭 키 암호기법은 비밀 키 암호기법으로도 알려져 있다. 이는 공유 키가 참여자들에게만 알려져야 하기 때문이다.
- 미국 국립 표준 기술원(NIST)에서 연속적인 대칭 키 암호기법의 표준을 제안하였다. `데이터 암호화 표준(DES)`이 첫 번째로서 주먹구구식 검색보다 나은 방법이 발견된 적이 없는 기법이다. DES 키(독립적인 56비트)도 현재의 프로세서 속도에 비하면 너무 작다. 
- NIST는 `3중 DES`를 표준화했는데, 이는 DES의 암호해독의 저항성을 향상시키기 위하여 실질적으로 DES 키의 길이를 증가시켰다. 3DES 키는 168(56*3)개의 독립적인 비트로 구성되며, 3개의 DES 키로 사용된다. 블록의 3DES 암호화는 먼저 블록을 DES1로 암호화하고, 이 결과를 DES2를 사용하여 암호해독한 다음, 마지막으로 이 결과를 DES3을 사용하여 다시 암호화하는 단계로 진행된다. 암호해독 단계에는 DES3으로 암호해독하고, 이어서 DES2로 암호화, DES1로 암호해독하는 단계를 거친다.
- 3DES 암호화에 DES2를 이용한 암호해독 단계가 들어가는 이유는 기존의 DES 시스템과의 연동을 위해서이다. 기존 시스템이 특정 키를 사용한다면 3DES 시스템은 이 키를 DES1, DES2, DES3으로 동시에 사용하여 동일한 암호화 결과를 계산할 수 있다.
- 3DES가 DES의 키 길이 문제를 해결했다 하더라도 여전히 다른 단점이 남아 있다. DES/3DES의 소프트웨어 구현은 아주 느리다. 또한 DES/3DES는 64비트 블록크기를 사용하는데 블록의 크기가 클수록 더욱 효과적이고 안전하다.
- 3DES는 NIST에 의해 제안된 개선된 암호화 표준(AES)으로 대체되었다. AES는 128, 192, 256비트 길이의 키를 지원하고, 블록의 길이는 128비트이다. AES는 소프트웨어나 하드웨어로 빠른 구현이 가능하다. 이 기법은 많은 메모리를 요구하지 않으므로 소형 이동기기에도 적합하다.

### 공개 키 암호기법
- 대칭 키 암호기법과 다른 기법은 비대칭 혹은 공개 키 암호기법이다. 공개 키 암호기법에서는 연고나된 한 쌍의 키를 사용하는데, 하나는 암호화를 위하여 다른 하나는 암호해독을 위하여 사용한다. 이 한 쌍의 키는 한 참여자가 보유한다. 보유자는 암호해독 키를 비밀로 유지하여 자신만이 메시지를 해독할 수 있도록 하는데 이 키를 개인키라 한다. 보유자는 암호화 키를 공개하여 누구나 자신을 위하여 메시지를 암호화 할 수 있도록 하는데 이 키를 공개키라 한다. 명확하게 이 기법이 사용되기 위해서는 공개 키로부터 개인 키를 유추하는 것이 불가능해야만 한다. 결과적으로 누구나 공개 키를 얻어서 암호화된 메시지를 키의 보유자에게 보내면 이 메시지를 암호해독하기 위해 필요한 키는 오직 보유자만이 가지고 있다.
- 대칭 키 암호기법에서의 키는 참여자 간의 양방향이고, 즉 각 참여자가 동일한 키를 가지고 양방향으로 메시지를 암호화하거나 암호해독할 수 있다. 공개/개인 키 쌍은 단방향의, 점 대 다중 채널을 제공하며, 공개 키를 가진 누구라도 개인 키를 가진 보유자에게 보낼 수 있다.
- 공개 키 암호기법의 중요한 부가 기능은 개인 암호해독 키를 메시지를 암호화하기 위한 암호화 알고리즘에서 사용하여 공개 암호화 키로만 암호해독하도록 하는 기능이다. 이 특성은 공개 키를 가진 누구라도 이런 메시지를 암호를 해독할 수 있으므로 명확하게는 기밀성에 도움이 되는 것은 아니다. 그러나 이 특성은 인증을 위하여 유용한 기능이다. 이는 이런 메시지의 수순자에게 키의 보유자만이 이런 메시지를 생성할 수 있다는 사실을 알려주기 때문이다. 공개 키를 가진 누구라도 암호화된 메시지를 해독할 수 있으며 암호해독의 결과가 예상 결과와 일치한다고 가정하면 개인 키를 암호화에 사용할 수 있다고 결론내릴 수 있다는 것이다.
- 공개 키 암호기법은 인증이나 기밀성을 유지하면서 대칭 키를 분배하기 위하여 사용하고, 나머지의 기밀성은 대칭 키 암호기법의 경우에 주로 사용된다.
- RSA는 아주 큰 수를 인수분해하는 아주 높은 계산 비용에 의지하고 있다. RSA가 안전하기 위해서는 적어도 1024비트 정도의 비교적 큰 키가 필요하다. 따라서 대칭 키 암호기법에서의 키보다 RSA의 키가 길어진다. 그 이유는 모든 키 공간을 소모적으로 검색하는 것보다는 키의 쌍이 기반으로 하고 있는 큰 수를 인수분해하여 RSA의 개인 키를 찾아 내는 것이 훨씬 빠르기 때문이다.
- ElGamel은 이산 로그방식으로 효과적인 해법을 찾지 못하는 문제이다. 이 기법에서도 최소한 1024비트의 키가 요구된다. 이런 이산 로그 문제의 변종도 있다. 입력이 타원곡선인 경우에 나타나고 훨씬 더 계산하기 어려운 것으로 여겨지는 문제이다. 이 문제에 기반을 둔 암호작성 기법을 타원곡선 암호작성법이라 한다.
- 공개 키 암호기법들은 대칭 키 암호기법에 비하여 몇 차수나 느리다. 결과적으로 대칭 키 방식이 거의 대부분의 암호화에 사용되고 공개 키 암호기법은 인증이나 세션키 확립을 위하여 사용된다.

### 인증인자
- 암호화만으로는 데이터의 무결성을 제공하지 못한다. 예를 들어, 임의로 변경된 암호문 메시지도 정상으로 보이는 평문으로 해독되는 값으로 나타난다. 이런 변경이 수신자에 의해 발견되지 않을지도 모른다. 또한 암호화 자체만으로는 인증을 제공하지 못한다. 메시지의 내용이 변경되었다면 그 메시지가 특정 참여자로부터 온 것이라고 말하는 것은 의미없다.
- `인증인자`란 전송될 메시지에 포함될 값으로써 메시지의 인증과 데이터 무결성을 동시에 검증하는 데 사용된다. 
- 데이터 무결성을 지원하기 위하여 인증인자는 메시지 내용에 대하여 부가적인 정보를 포함하고 있다. 이는 마치 체크섬이나 CRC와 유사하다. 인증을 지원하기 위하여 인증인자에는 누가 인증인자를 생성했는지 간에 자신이 이 메시지의 발신자만에게만 알려진 비밀을 알고 있다는 증거가 포함되어야 한다. 예를 들어, 이 비밀은 키가 될 수 있고, 증거란 이 키를 이용하여 암호화된 값이 될 수 있다. 부가정보의 형태와 비밀을 알고 있다는 증명의 형태에는 상호 연관성이 있다.
- 인증인자의 한 종류는 암호화와 `암호작성 해시 함수`의 조합이다. 암호작성 해시 함수는 내용의 변경을 노출시키기 위하여 메시지에 대한 부가 정보를 생성해 주는 함수이다. 체크섬이나 CRC가 잡음이 있는 링크 상에서 발생된 비트의 오류를 노출해 주는 것과 같이 암호작성 해시 함수는 적대자가 메시지의 내용을 계획적으로 변경했을 때 이를 노출하도록 설계되었다. 이 함수가 생성하는 값을 `메시지 요약`이라 하고, 이는 원래의 체크섬과 마찬가지로 메시지에 추가된다. 주어진 해시 함수에 의해 생성된 메시지 요약은 원래의 메시지 길이와 무관하게 동일한 수의 비트로 구성된다. 가능한 입력 메시지의 공간이 가능한 메시지의 요약의 공간보다 크므로, 해시 테이블에서의 충돌과 비슷하게, 서로 다른 입력 메시지에서 같은 메시지 요약이 생성되기도 한다. 암호기법 알고리즘에서와 같이 암호작성 해시 알고리즘도 공개된 것으로 간주된다.
- 인증인자는 이 메시지 요약을 암호화하여 생성한다. 수신자는 메시지의 평문 부분에 대한 메시지 요약을 이를 메시지 요약의 암호해독 값과 비교하여, 두 값이 일치하면 수신자는 이 메시지가 실제로 예상한 발신자로부터 온 것이고 그 내용이 변경되지 않았다고 결론지을 수 있다. 어떤 적대자도 적절한 가짜 메시지 요약을 가진 가짜 메시지를 보낼 수 없다. 그 이유는 그들은 가짜 메시지 요약을 정확히 생성할 수 있는 키를 가지고 있지 못하기 때문이다. 그러나 적대자는 원래 메시지의 평문과 암호화된 요약을 도청을 통해 취득할 수 는 있다. 적대자는 해시 함수가 공개되어 있으므로 원래 메시지의 요약을 계산할 수 있고, 동일한 메시지 요약을 가지는 다른 메시지를 생성할 수도 있다. 적대자가 이런 메시지를 발견한다면 그는 예전의 인증인자와 함께 새 메시지를 들키지 않고 보낼 수 있다. 그러므로 보안을 위하여 해시 함수는 반드시 단방향 특성을 가져야 한다. 적대자가 원본과 동일한 요약을 가진 다른 평문 메시지를 발견하는 것이 계산상 불가능해야 한다.
- 해시 함수가 이런 요구를 만족시키려면 그 계산 결과들이 무작위로 분산되어야 한다. 예를 들어, 요약이 128비트 길이이고 무작위로 분산되어 있다면 주어진 메시지와 요약이 일치하는 두 번째 메시지를 발견하기 위하여 평균적으로 2^127개의 메시지를 시도해 보아야 한다. 계산 결과가 무작위로 분산되어 있지 못한 경우, 즉 다른 것들에 비하여 특정 결과가 나올 확률이 높은 경우에는 일부 메시지에 대하여 동일한 요약을 가진 다른 메시지를 발견하는 것이 더욱 용이해질 것이다. 이런 경우에는 이 알고리즘의 안전성이 훼손될것이다. 이것 대신에 충돌을 발견하려는 시도가 있을 수 있는데 이 경우에도 평균적으로 2^64 메시지의 요약을 계산해야 한다.
- 가장 일반적인 암호작성 해시 알고리즘이 메시지 요약 5(MD5)와 보안 해시 알고리즘1(SHA-1)이다. MD5는 128비트의 요약을 생성하고 SHA-1은 160비트의 요약을 생성한다. 충돌 공격은 원상 공격(주어진 처음 메시지와 충돌하는 다른 메시지를 발견하는 것을 기반으로 하는 공격)과 같은 치명적 위험은 아니지만 여전히 위험하다. NIST는 SHA-1을 폐기하고 SHA-2를 하려한다.
- 인증인자를 생성하는 방식에서 메시지 요약의 암호화에는 대칭 키 암호화 기법이나 공개 키 암호화 기법을 사용할 수 있다. 공개 키 암호기법이 사용된다면 요약은 발신자의 개인 키를 이용하여 암호화한다. 그리고 수신자는 발신자의 공개 키를 이용하여 암호해독을 한다.
- 공개 키 알고리즘에서 개인 키를 이용하여 암호화된 요약을 `디지털 서명`이라 한다. 이는 이 요약이 문서에 직접 서명한 것과 같은 효력을 제공하기 때문이다. 디지털 서명과 함께 메시지를 받은 수신자는 발신자가 실제로 이 메시지를 보냈다는 것을 제3자에게 증명할 수 있기 때문이다. 이경우 제3자 자신이 직접 발신자의 공개 키를 이용하여 이를 검사할 수 있다. 모든 공개 키 암호기법은 디지털 서명으로 사용할 수 있다. `디지털 서명 표준(DSS)`은 NIST에서 표준화한 디지털 서명 형식이다. DSS에서는 3가지의 공개 키 방식 중 어느 하나를 사용할 수 있따. 하나는 RSA를 기반으로, 다른것은 ElGamel를 기반으로, 그리고 세번째는 타원곡선 디지털 서명 알고리즘을 기반으로 하고 있다.
- 인증인자의 다른 종류도 유사하다. 단 해시를 암호화하는 대신 비밀값을 매개변수로 하는 해시와 유사한 함수를 사용한다. 이와 같은 함수는 `메시지 인증 코드(MAC)`라는 인증인자를 생성한다. 발신자는 이 MAC를 자신의 평문 메시지에 추가한다. 수신자는 평문 메시지와 비밀값을 사용하여 MAC를 다시 계산하고, 다시 계산된 MAC를 수신한 MAC와 비교한다.
- MAC의 일반적인 변종은 암호작성 해시를 평문 메시지와 비밀값의 조합에 적용하는 방식이다. 여기서 생성된 요약은 기본적으로 MAC이므로 `해시화 메시지 인증 코드(HMAC)`라 한다. HMAC은 비밀값을 제외하고 평문 메시지에 추가된다. 비밁밧을 알고 있는 수신자만이 정확한 HMAC을 계산하고, 이를 수신된 HMAC과 비교할 수 있다. 이때 해시의 단방향 특성이 없다면 적대자는 HMAC을 생성한 입력을 찾아 내고 이를 평문 메시지와 비교하여 비밀값을 알아 낼수 있을 것이다.
- 인증인자를 가진 메시지에 기밀성을 부가하려면 인증인자를 포함한 전체 메시지의 조합을 암호화하면 된다. 실제로 기밀성은 공개 키보다 빠른 대칭키를 주로 사용하고 있다. 더 나아가 인증인자를 암호화에 추가하는 것은 비용이 거의 들지 않으면서 보안은 향상되도록 해준다. 일반적으로 단순화하면 메시지를 원래 요약과 함께 암호화하여 요약이 한번만 암호화되도록 한다. 이 경우 전체 암호문 메시지를 인증인자로 볼 수 있다.
