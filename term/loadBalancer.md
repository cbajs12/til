## Load Balancer
### 스위치 분류
- L2: mac주소를 참조하여 스위칭하는 장비
- L3: Ip주소를 참조하여 스위칭하는 장비
- L4: Ip주소 및 tcp/udp포트 정보를 참조하여 스위칭하는 장비
- L7: Ip주소, tcp/udp포트 정보 및 패킷 내용까지 참조하여 스위칭하는 장비

### L4/L7스위치 용도
- 로드벨런싱을 위해 사용됨
- 복수개의 웹서버가 있을때, 임의의 웹서버에 접속을 시도하면 스위치가 각 서버의 부하를 고려하여 적당한 서버와 연결시켜준다.

### L4스위치
- 계층4에서 패킷을 확인하고 세션을 관리하며, 로드벨런싱을 제공
- Tcp/Udp패킷 정보를 분석해서 해당 패킷이 사용하는 서비스 종류별로 처리(HTTP,FTP..)
- 세션관리, 서버/방화벽 로드벨런싱, 네트워크 서비스 품질 보장

### L7스위치
- L4스위치의 서비스 단위 로드벨런싱을 극복하기 위해 포트 + 데이터 페이로드 패턴을 이용한 패킷 스위치(email내용/제목, URL..)
- 커넥션풀(시스템 부하감소)
- 트레픽 압축(컨텐츠 압축전송)
- 보안기능

### L4 & L7
#### 공통점
- 스위치로 들어온 패킷을 적절한 목적지로 전송, 불필요한 패킷은 드랍

#### 차이점
- 기능과 역할은 동일하나 패킷을 분석하는 인텔리전스가 다름
- L7은 보안기능 강화(DOS/SYN공격방어, 감염패킷 필터링, 네트워크 자원독점 방지등)
- L7은 알려진 일반 포트에 대한 세션처리는 가능하지만, 순간적으로 사용하는 임시포트는 제한적으로 인지한다.

#### sticky session
- L4스위치를 통해 분배된 서비스 세션은 하나의 연결 요청에 1~n중에 한대의 서버에 분배된다.
- 여러번 시도해도 그때마다 1~n중에 한대에 분배되므로, 같은 서버에 접속될 확률은 1/n이다 그러나 처음에 접속했던 서버와 같은 서버에 계속 연결시킬수 있는데 이것이 Sticky옵션이다.
- 기존 사용자의 세션 상태를 timeout시간 내에는 계속 유지시켜주는것이 sticky session이다.

##### 문제점
- 로드벨런싱이 제대로 동작하지 않을수있다.
- 개별 사용자가 사용할 경우에는 세션 timeout이 있으므로 어느 정도 로드벨런싱을 충족시킨다 그러나 프록시 서버를 사용하는경우 여러 사람이 timeout시간내에 접속하는경우 계속해서 한서버에만 로드가 집중된다.

##### 대안
- SSL이나 기타 다른 보안모듈을 이용해서 인증된 특정 사용자에 대해서 Cookie/DB에 기록후 해당 사용자에 대해서만 세션을 유지하도록 한다.(단점: 성능저하, 기타 cost)
- L7스위치사용

#### L7 스위칭 방식
##### URL스위칭
- URL주소에서 특정 String을 검사하고, 검색된 문자열을 기준으로 부하를 분산시킨다.

##### Cookie스위칭
- Http헤더의 cookie값에 따른 특정 String을 기준으로 부하를 분산하는 방식
- Cookie값 필드를 보고 설정된 분류 기준에 따라 어느 서버로 보낼지 결정

##### Content스위칭
- Http헤더의 모든 필드를 기반으로 한다.
- XML content를 기반으로 한다.
- XML tags나 multiple Http 헤더를 기준으로 복잡한 로드벨런싱을 구현한다.
- Cookie와 Http 헤더의 insertion과 deletion을 포함한 contents-rewrite기능을 지원한다.
- Alternate한 url이나 도메인의 redirecting request를 지원한다.

### reference
- http://freeism.web-bi.net/tc/657
