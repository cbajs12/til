## 2. HTML 속의 Javascript

### `<script>` 요소
- 자바스크립트를 HTML 페이지에 삽입하는 일차적인 방법은 `<script>` 요소를 통하는 것이다. 이것에는 6가지 속성이 있다.
- async : 스크립트를 즉시 내려받지만 자원을 내려받거나 다른 스크립트를 불러오는 등 다른 페이지 작업을 방해해서는 안된다고 지시한다. 외부 스크립트 파일을 불러올 떄만 유효하다.
- charset : src 속성으로 명시한 코드의 문자셋을 지정한다. 브라우저는 대개 이 속성의 값을 무시하므로 잘 쓰이지 않는다.
- defer : 문서의 콘텐츠를 완전히 파싱하고 표시할 떄까지 스크립트 실행을 지연해도 안전함을 나타낸다. 외부 스크립트 파일을 불러올 떄문 유효하다.
- language : 폐기됨, 대부분의 브라우저에서 이 속성을 무시하기에 써서는 안된다.
- type : language 속성을 대체할 의도로 만들어졌다. 스크립트 언어의 콘텐츠 타입을 지정한다. 이 속성은 습관적으로 또는 브라우저 호환성을 위해 'text/javascript'라 표기하지만, 생락해도 기본적으로 'text/javascript'로 인식한다.
- src : 실행할 코드를 포함한 외부 파일의 위치를 지정

#### 기본 특징
- `<script>` 요소는 두 가지 방법으로 사용한다. 자바스크립트 코드를 페이지에 직접 작성할 수 있고 외부 파일에서 불러올 수 있다.
- `<script>` 요소 내부의 코드는 위에서부터 차례로 해석된다. `<script>` 요소 내부의 코드 전체를 평가하기 전에는 페이지의 나머지 콘텐츠를 불러오지도 않고 표시하지도 않는다.
- 인라인 코드에서 `</script>` 문자열을 사용할 수 없다. 이것을 브라우저의 태그로 인식하기 때문이다. `<\/script>`의 방법으로 써야한다.
- 인라인 코드와 같이 외부 파일의 코드를 해석하는 동안에는 페이지 처리가 멈춘다. 또한, 외부 속성 불러올때 XHTML 문서에서는 닫는 태그를 사용하지 않아도 된다.

#### 알아야 할 것
- `<script>` 와 `</script>` 사이에 스크립트 코드가 있고 src를 사용해서 외부에서 스크립트를 불러온다면 그 스크립트를 내려받아 실행하며 인라인 코드는 무시된다.
- `<script>` 요소에서 가장 논란인 점은 다른 도메인에 있는 자바스크립트를 불러오는 능력이다. src 속성에 파일의 위치를 나타내는 URL을 쓴다. 외부 파일은 페이지와 같은 서버에 있어도 되고 완전히 다른 도메인에 있어도 된다. 그러나 이와 같은 코드는 악의적인 파일을 불러올 수도 있다.
- defer와 async 속성이 있을 때 `<script>` 요소는 페이지에 나타난 순서대로 실행되지 않는다.

### 태그 위치
- 전통적으로 `<head>`에 자바스크립트 참조를 한곳에서 관리하지만, 모든 자바스크립트 파일을 head에서 불러온다면 모든 파일을 내려받고 파싱하고 해석을 끝날 때까지 렌더링을 멈춘다. 브라우저는 `<body>` 태그를 만나면서 페이지 렌더링을 시작하기 떄문이다. 그렇기 때문에 최신의 앱은 body 요소 안에, 페이지 콘텐츠 마지막에 쓴다. 이러면 페이지 렌더링을 모두 마친다음 자바스크립트를 처리한다.

### 스크립트 처리 지연
- defer 속성의 목적은 스크립트에서 페이지 구조를 바꾸지 않는다고 명시하는 것이다. 따라서 페이지 전체를 파싱한 후 스크립트를 실행해도 상관없다.
- defer 속성을 설정하면 브라우저는 해당 요소를 만나는 즉시 코드를 내려받지만 실행은 지연한다.
- 명세상으로는 defer는 순서대로 실행됨을 보장하지만, 현실적으론 defer 속성으로 지연시킨 스크립트가 항상 순서대로 실행되지 않으며 DOMContentLoaded 이벤트보다 먼저 실행된다는 보장도 없으므로 가능하다면 `<script>` 요소는 하나만 쓰는 것이 최선이다.
- 브라우저마다 defer 지원이 다르므로, 지연시킬 스크립트는 페이지 맨 마지막에 놓는 편이 최상이다.

### 비동기 스크립트
- async 속성은 defer 속성과 비슷한 방법으로 스크립트를 처리한다. 외부 스크립트에만 적용되며 브라우저에게 파일을 즉시 받으라고 지시한다.
- async는 스크립트가 순서대로 실행된다는 보장이 없다. 그러므로 async 속성의 스크립트들은 의존성이 있어서는 안된다.
- async의 목적은 스크립트를 모두 내려받아 실행할 떄까지 기다릴 필요 없이 페이지 렌더링을 시작해도 좋으며 앞선 스크립트 파일을 기다리지 않고 뒤에 있는 파일을 내려받아도 좋다고 명시하는 것이다. 이런 이유로 DOM을 조작하는 스크립트는 비동기적으로 불러오지 않는 것이 좋다.
- 비동기 스크립트는 페이지의 load 이벤트 전에 반드시 실행되나, DOMContentLoaded 이벤트보다는 앞설 수도 있고 그 이후일 수도 있다.

### XHTML에서 바뀐 점
```javascript
<script>
//<![CDATA[
    function com(a, b){
        alert('a')
    }
//]]>
</script>
```

- XHTML은 HTML에 XML을 적용한 것이다. XHTML 코드 규칙은 HTML보다 엄격하다.
- XHTML 문법 에러를 두 가지 방법으로 수정할 수 있다. 한 가지는 문제가 되는 기호를 HTML 엔티티로 바꾸는 방법이다. 또 다른 한가지는 자바스크립트 코드를 CDATA 섹션으로 감싸는 것이다. XHTML과 XML에서 CDATA 섹션은 해당 콘텐츠가 있는 그대로의 텍스트이며 파싱하면 안된다고 명시하는 기능이 있다.
- XHTML 호환 웹 브라우저에서는 이 방법으로 문제가 해결된다. 그러나 많은 브라우저가 XHTML 비호환이고 CDATA 섹션을 지원하지 않는다. 이를 해결하려면 CDATA 마크업 앞에서 자바스크립트 주석 기호를 써야한다.

#### 인라인 코드와 외부 파일
- 일반적으로 자바스크립트는 외부 파일로 분리하는 방법이 모범적이다.
- 외부 파일로 분리하는 것의 장점은 관리하기 쉽고, 캐싱하기 용이하고, CDATA 섹션이나 주석편법을 쓰지 않아도 되는 점들이다.

### 문서 모드
- 문서모드에는 쿽스 모드, 표준 모드, 거의 표준 모드가 있다.
- 문서의 시작 부분에 독타입을 쓰지 않으면 모든 브라우저에서 쿽스 모드를 사용한다. 이는 안좋은 예이다 왜냐하면 쿽스 모드는 브라우저마다 대단히 달라 브라우저마다 일관성을 기대할 수 없기 때문이다.
- 거의 표준 모드는 트랜지셔널이나 프레임셋 독타입에서 사용된다.

### `<noscript>` 요소
- 단계적 후퇴를 위하여 브라우저가 자바스크립트를 지원하지 않을 때 대체 콘텐츠를 제공하기 위해 만들어졌다.
- `<noscript>` 요소는 `<script>`를 제외한 모든 HTML 요소를 포함할 수 있다.
- `<noscript>` 요소의 콘텐츠는 브라우저가 스크립트를 지원하지 않거나 브라우저의 스크립트 지원이 꺼져 있을 떄이다. 이 둘중 하나를 만족하면 `<noscript>`의 내용이 렌더링된다.